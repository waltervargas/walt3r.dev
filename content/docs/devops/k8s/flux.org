#+title: FluxCD and K8s
#+subtitle: subtitle
#+date: <2023-04-06 Thu>
#+draft: true
#+tags[]: fluxcd, k8s, terraform

How to manage k8s with flux, first needs to be installed some how:

#+begin_src hcl
terraform {
  required_providers {
    flux = {
      source  = "fluxcd/flux"
      version = ">= 0.20.0"
    }
  }
}

/* flux provdier */
provider "flux" {
  kubernetes = {
    config_path = "~/.kube/config"
    config_context = "k3d-k3s-default"
  }
  git = {
    url = "http://gitlab.home.walter.bio/walter/k8s.git"
    http = {
      username = "git"
      password = local.gitlab_token
      allow_insecure_http = true
    }
  }
}

locals {
  gitlab_token = "secret"
}

resource "flux_bootstrap_git" "k3d" {
  path = "clusters/k3d"
}
#+end_src
